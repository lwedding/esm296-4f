<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Ben Best" />


<title>Lab 1: Global Wind Production with ArcPy</title>

<script src="lab1_files/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="lab1_files/bootstrap-2.3.2/css/bootstrap.min.css" rel="stylesheet" />
<link href="lab1_files/bootstrap-2.3.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
<script src="lab1_files/bootstrap-2.3.2/js/bootstrap.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="lab1_files/highlight/default.css"
      type="text/css" />
<script src="lab1_files/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
</style>
<div class="container-fluid main-container">


<div id="header">
<h1 class="title">Lab 1: Global Wind Production with ArcPy</h1>
<h4 class="author"><em>Ben Best</em></h4>
<h4 class="date"><em>October 1, 2014</em></h4>
</div>

<div id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#data"><span class="toc-section-number">2</span> Data</a></li>
<li><a href="#methods"><span class="toc-section-number">3</span> Methods</a><ul>
<li><a href="#download-data"><span class="toc-section-number">3.1</span> Download Data</a></li>
<li><a href="#prep-workspace"><span class="toc-section-number">3.2</span> Prep Workspace</a></li>
<li><a href="#extract-raster-layer-from-netcdf"><span class="toc-section-number">3.3</span> Extract Raster Layer from NetCDF</a></li>
<li><a href="#calculate-speed-from-u-and-v-winds"><span class="toc-section-number">3.4</span> Calculate Speed from U and V Winds</a></li>
<li><a href="#resample-raster"><span class="toc-section-number">3.5</span> Resample Raster</a></li>
<li><a href="#use-iterator-in-model-builder"><span class="toc-section-number">3.6</span> Use Iterator in Model Builder</a></li>
<li><a href="#export-to-script"><span class="toc-section-number">3.7</span> Export to Script</a></li>
<li><a href="#winpython"><span class="toc-section-number">3.8</span> WinPython</a></li>
<li><a href="#intro-to-python"><span class="toc-section-number">3.9</span> Intro to Python</a></li>
<li><a href="#python-window-in-arcmap"><span class="toc-section-number">3.10</span> Python Window in ArcMap</a></li>
<li><a href="#simplify-and-loop"><span class="toc-section-number">3.11</span> Simplify and Loop</a></li>
<li><a href="#use-dates-in-loop"><span class="toc-section-number">3.12</span> Use Dates in Loop</a></li>
<li><a href="#extract-country-summary"><span class="toc-section-number">3.13</span> Extract Country Summary</a><ul>
<li><a href="#cell-statistics"><span class="toc-section-number">3.13.1</span> Cell Statistics</a></li>
<li><a href="#zonal-statistics"><span class="toc-section-number">3.13.2</span> Zonal Statistics</a></li>
<li><a href="#join-field"><span class="toc-section-number">3.13.3</span> Join Field</a></li>
</ul></li>
<li><a href="#create-map-of-countries-wind-production"><span class="toc-section-number">3.14</span> Create Map of Countries Wind Production</a></li>
<li><a href="#report-in-markdown"><span class="toc-section-number">3.15</span> Report in Markdown</a></li>
<li><a href="#extra-create-raster-catalog-for-time-slider-visualization"><span class="toc-section-number">3.16</span> Extra: Create Raster Catalog for Time Slider Visualization</a></li>
<li><a href="#more-on-python"><span class="toc-section-number">3.17</span> More on Python</a></li>
</ul></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p><strong>Goal</strong>. You’ve been tasked by the United Nations to assess countries with highest possible wind energy production.</p>
<p>This lab, similar to the wind siting analysis Lab 3 from ESM 263 (GIS), has you examining wind data for wind farm site suitability. However here we’ll only be looking at the wind production aspect globally and not other finer scale suitability components. Although simplified in that sense we’ll be adding a few dimensions:</p>
<ul>
<li><p><strong>Time</strong>. Rather than being provided average wind production throughout the year, you’re provided with daily wind data for a given year. The task then is to work out an annual average. This introduces analysis in time and necessitates a looping strategy. We’ll show you how to do this in Model Builder with Iterators and programmatically in Python. You’ll learn only the cursory basics in Python for now to complete the task. You’ll then create a Script Tool to easily perform the same analysis for any year of data. You’ll also learn how to visualize geographic elements temporally using the Time Slider and even outputting a video.</p></li>
<li><p><strong>Polar Coordinates</strong>. Rather than simply being given the wind speed, you are provided wind speed in the horizontal (<span class="math">\(u\)</span>) and vertical (<span class="math">\(v\)</span>) direction. These vectors are in the “Cartesian coordinate system” and can be translated into the “polar coordinate system” giving us the speed (<span class="math">\(s\)</span>) using good ol’ Pythagorean theorem <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>:</p></li>
</ul>
<p><img src="img/polar_cartesian.png" /> <!-- 
  Google drawing source:
  https://docs.google.com/a/nceas.ucsb.edu/drawings/d/1PFUPMmjjDKs6SHRVVPFy4hY0G9oSzR5cer39ShS0PiU/edit 
  --></p>
<p><span class="math">\[
  s = \sqrt{u^2 + v^2}
  \]</span></p>
<p><span class="math">\[
  \theta = atan2(u, v)
  \]</span></p>
<ul>
<li><p><strong>Scientific Data Format</strong>. You’ll notice the <span class="math">\(u\)</span> and <span class="math">\(v\)</span> data files also have a *.nc filename extension which stands for “NetCDF” (Network Common Data Format) developed originally by climate scientists for exchanging scientific data in a variety of structures. Another common open-source scientific data format developed by the remote sensing community is “HDF” (Hierarchical Data Format)<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>. In this case the <span class="math">\(u\)</span>.nc and <span class="math">\(v\)</span>.nc data represent a cube of dimensions <span class="math">\(x\)</span>, <span class="math">\(y\)</span> and <span class="math">\(t\)</span>. We’ll be extracting a time slice <span class="math">\(t\)</span> of the <span class="math">\(u\)</span> or <span class="math">\(v\)</span> wind values over the <span class="math">\(x\)</span> and <span class="math">\(y\)</span> direction.</p>
<p><img src="img/rubik-cube_x-y-t_sized.png" /> <!-- source: https://docs.google.com/a/nceas.ucsb.edu/drawings/d/1K1ruRAgXhz6A8IgzgD4eXgXZTHakQZ75oF3rWZK1Wv8/edit --></p></li>
</ul>
<p>Finally, you’ll be using the best of breed scientific programming tools to track changes in the files you create (<strong>git</strong>) and publish an executive summary report to an online project management interface (<strong>Github</strong>). You’ll make this report in a language (<strong>markdown</strong>) that easily converts to an html web page (and other formats).</p>
</div>
<div id="data" class="section level1">
<h1><span class="header-section-number">2</span> Data</h1>
<ul>
<li><strong>NCEP Reanalysis Wind Data</strong><br> <a href="http://www.ncdc.noaa.gov/societal-impacts/wind">http://www.ncdc.noaa.gov/societal-impacts/wind</a>
<ul>
<li>spatial resolution: 2.5 x 2.5 degrees and temporal resolution daily.</li>
<li>temporal resolution: daily</li>
<li>file format: netcdf (*.nc)</li>
</ul>
<div class="figure">
<img src="img/sig995_wind_201308.gif" alt="Figure 1. Mean wind speed in USA interpolated to 0.25 x 0.25 degrees." /><p class="caption"><em>Figure 1. Mean wind speed in USA interpolated to 0.25 x 0.25 degrees.</em></p>
</div></li>
<li><strong>Natural Earth | 1:10m Cultural Vectors | Admin 0  Countries</strong><br> <a href="http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-countries/">http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-countries/</a>
<ul>
<li>spatial resolution: 1:10m</li>
<li>version:</li>
<li>file format: shapefile (*.shp)</li>
</ul>
<div class="figure">
<img src="img/natural-earth_admin0_countries.png" alt="Figure 2. Natural Earth administrative boundaries." /><p class="caption"><em>Figure 2. Natural Earth administrative boundaries.</em></p>
</div></li>
</ul>
</div>
<div id="methods" class="section level1">
<h1><span class="header-section-number">3</span> Methods</h1>
<div id="download-data" class="section level2">
<h2><span class="header-section-number">3.1</span> Download Data</h2>
<p>You can use the URLs above to download the data or just download the 7-zipped file:</p>
<p><a href="https://purl.org/net/frew/ESM296/wk1/raw.7z">https://purl.org/net/frew/ESM296/wk1/raw.7z</a></p>
<p>I recommend placing this in <code>H:\esm296-4f\lab1</code>, right clicking 7-Zip &gt; Extract here.</p>
</div>
<div id="prep-workspace" class="section level2">
<h2><span class="header-section-number">3.2</span> Prep Workspace</h2>
<p>Fire up ArcMap and create in the Catalog pane:</p>
<ul>
<li>a new blank map, save it in <code>H:\esm296-4f\lab1</code> as <code>lab1.mxd</code>.</li>
<li>new file geodatabase as <code>lab1.gdb</code></li>
<li>new toolbox as <code>lab1.tbx</code></li>
<li>new folder <code>out</code></li>
</ul>
<p>Right click on lab1.gdb to Make Default Geodatabase.</p>
<p>You’ll need to have the Spatial Analyst extension ticked on (ArcMap menu Customize &gt; Extensions)</p>
</div>
<div id="extract-raster-layer-from-netcdf" class="section level2">
<h2><span class="header-section-number">3.3</span> Extract Raster Layer from NetCDF</h2>
<p>Create a new Model within lab1.tbx and Edit it. Set Model &gt; Model Properties to “Store relative path names” and give it a name and label of “uv_nc_to_s_tif”.</p>
<p>Now add the <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//004300000006000000">Make NetCDF Raster Layer</a> tool navigate to the input file <code>raw/uwnd.sig995.2013.nc</code> (note: <code>u</code> and <code>2013</code>) with further parameters like so:</p>
<div class="figure">
<img src="img/arc_make-netcdf-raster-layer_params.png" />
</div>
<p>Run this tool to see the output in ArcMap. You might need to right-click on the output Add To Display.</p>
<p>Repeat for the <code>v</code> and <code>2013</code> file, swapping out instances of <code>u</code> for <code>v</code>.</p>
</div>
<div id="calculate-speed-from-u-and-v-winds" class="section level2">
<h2><span class="header-section-number">3.4</span> Calculate Speed from U and V Winds</h2>
<p>Now we’re ready to calculate the speed <span class="math">\(s\)</span> given vectors <span class="math">\(u\)</span> and <span class="math">\(v\)</span> using the <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//009z000000z7000000">Raster Calculator</a>. Apply the equation</p>
<p><span class="math">\[
  s = \sqrt{u^2 + v^2}
  \]</span></p>
<p>by entering the following parameters, choosing the variables (green triangle) and not layers (yellow diamond).</p>
<div class="figure">
<img src="img/arc_raster-calculator_params.png" />
</div>
<p>Notice the output is <code>in_memory\s_001</code> since we’re not quite to the final product so don’t need to write to disk just yet. This uses the <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//002w0000005s000000"><code>in_memory</code> workspace</a> so the interim output is not written to disk, but simply kept in memory for your session, like a layer.</p>
</div>
<div id="resample-raster" class="section level2">
<h2><span class="header-section-number">3.5</span> Resample Raster</h2>
<p>If you add a global basemap (File &gt; Add Data &gt; Add Basemap…) and make just <code>s_001</code> visible with some transparency, you’ll notice that this is much chunkier than Figure 1 above since that was resampled at 0.25 x 0.25 degrees from the original global 2.5 x 2.5 degrees raster. Let’s do the same with the <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//00170000009t000000">Resample</a> function using BILINEAR interpolation and output to <code>H:\esm296-4f\lab1\out\s_001.tif</code>.</p>
<p>At this point export a PNG of your Model for later writeup (Model &gt; Export &gt; To Graphic…) into <code>H:\github\courses\esm296-4f\lab1\img\uv_nc_to_s_tif.png</code>.</p>
</div>
<div id="use-iterator-in-model-builder" class="section level2">
<h2><span class="header-section-number">3.6</span> Use Iterator in Model Builder</h2>
<p>Ok, so we’ve got a decent product, but that’s only the first time index. And there’s 365, one for each day of the year. So let’s to get loopy!</p>
<p>This really should motivate you to create script, but you might as well also know about <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//002w0000001w000000">iterators in ModelBuilder</a>. Iterating through all 365 days is overkill for our purposes. Let’s just loop over one day per month.</p>
<p>To start, create another model with Save as… <code>uv_nc_to_s_tif_for_loop</code>. Add the For iterator by right clicking on empty part of the ModelBuilder canvas &gt; Iterators, and parameterize like so:</p>
<ul>
<li>From Value: 1</li>
<li>To Value: 365</li>
<li>By Value: 29</li>
</ul>
<p>Rename the default “value” output to “j” for <a href="http://en.wikipedia.org/wiki/Julian_day">julian day</a>, ie index day of the year. Be careful not to use “i” or “n” which are reserved variables for <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#/A_quick_tour_of_using_inline_variable_substitution/002w0000001t000000/">ArcGIS inline variable substitution</a>. You should see this in your model:</p>
<div class="figure">
<img src="img/arc-mb_for-j.png" />
</div>
<p>We can then use this variable in the parameters of the other tools by wrapping it with <code>%</code> (an old MS-DOS convention).</p>
<div class="figure">
<img src="img/arc-mb_make-netcdf-raster-layer_params-for-variable-j.png" />
</div>
<p>Continue swapping out all instances of <code>1</code> or <code>001</code> with <code>%j%</code> in the function parameters. The working equation for the Raster Calculator is:</p>
<pre><code>SquareRoot( Square(&quot;u_%j%&quot;) + Square(&quot;v_%j%&quot;) )</code></pre>
<p>The link from the u and v input to Raster Calculator gets lost, so you’ll need to link <code>u_%j%</code> and <code>v_%j%</code> to the Raster Calculator as a “precondition” so these get generated first and are available to the Raster Calculator.</p>
</div>
<div id="export-to-script" class="section level2">
<h2><span class="header-section-number">3.7</span> Export to Script</h2>
<p>While it gets the job mostly done, there are a few reasons I don’t like the above approach:</p>
<ul>
<li>The %j% substitution can get a little confusing.</li>
<li>The outputs don’t sort well since they’re not zero padded like s_001.tif.</li>
<li>The julian day or index number makes it hard to tell which month it should refer to and it won’t be the middle of the month exactly.</li>
<li>Every function within the model having an Iterator gets repeated that many times. We can’t perform a single process before to prepare the data nor after to summarize unless we <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//002w0000003z000000">create model parameters</a> and nest one model within another. Doable but less than straightforward.</li>
</ul>
<p>Instead, let’s start programming in Python where we have freedom for more sophisticated all-in-one analysis. To get started export the uv_nc_to_s_tif model (before including the iterator) to a Python script (Model Builder menu Model &gt; Export &gt; To Python Script…) and save to <code>H:\github\courses\esm296-4f\lab1\uv_nc_to_s_tif.py</code>.</p>
<p>Since you placed your script in the courses repo, you should see it show up in the git pane.</p>
<p><img src="img/rstudio_git_uv-model-py.png" />.</p>
<p>Go ahead and click on Commit tick the file to add it, include a message and click on Commit. Then as we improve upon the script you can see which parts changed and even revert back to past versions if needed.</p>
</div>
<div id="winpython" class="section level2">
<h2><span class="header-section-number">3.8</span> WinPython</h2>
<p>Let’s use a Python editor to open the script. You can simply navigate there in Windows Explorer, right click &gt; Edit with Pythonwin.</p>
<div class="figure">
<img src="img/winpython_edit.png" />
</div>
</div>
<div id="intro-to-python" class="section level2">
<h2><span class="header-section-number">3.9</span> Intro to Python</h2>
<p>Let’s look at a few sample lines of the exported code from ModelBuilder. Like Git Bash, Python comments are preceeded with <code>#</code>.</p>
<pre class="python"><code># Import arcpy module
import arcpy

# Check out any necessary licenses
arcpy.CheckOutExtension(&quot;spatial&quot;)


# Local variables:
uwnd_sig995_2013_nc = &quot;H:\\esm296-4f\\lab1\\raw\\uwnd.sig995.2013.nc&quot;

# ...

# Process: Make NetCDF Raster Layer
arcpy.MakeNetCDFRasterLayer_md(uwnd_sig995_2013_nc, &quot;uwnd&quot;, &quot;lon&quot;, &quot;lat&quot;, u_001, &quot;&quot;, &quot;time 1&quot;, &quot;BY_INDEX&quot;)</code></pre>
<p>The arcpy module is what provides all the ArcGIS geoprocessing functions. Syntax follows <code>object.function()</code> or <code>object.property</code>. Input arguments to a function are surrounded by paranthesis and seperated by commas. Assignment of variables is with <code>=</code> whereas testing equality is <code>==</code> which would return True or False. You can try out the following lines in the Interactive Window of PythonWin.</p>
<pre class="python"><code>1 + 1
a = 1
b = 2
a == b

import antigravity</code></pre>
<p>While it’s a nice editor, you can’t simply copy/paste more than one line of code from and Editor window to the Interactive Window (although you can copy multiple lines, right-click in Interactive Window and “Execute python code from clipboard”).</p>
</div>
<div id="python-window-in-arcmap" class="section level2">
<h2><span class="header-section-number">3.10</span> Python Window in ArcMap</h2>
<p>I prefer editing code in Winpython and running chunks of code in ArcMap’s <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//002100000017000000">Python window</a> (available from the main toolbar as <img src="img/python_cmd_btn.png" />) which does allow copy and paste of multiple lines of code.</p>
<div class="figure">
<img src="img/arcmap_python_window.png" />
</div>
<p>Launch the Python Window in ArcMap and try out the following explained in <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//002100000018000000">Using the Python window</a>.</p>
<pre class="python"><code>
# hello world
print &quot;Hello Jack!&quot;
count = 0
count

# assignment
x = 1
y = 2
print x + y


# a loop. note the indentation
for count in range(1,5):
  print count
  

# paths: these all work the same when passed to a function
# the backslash is the &quot;escape&quot; character like \n for newline or \t for tab
#   so have to escape the escape character (thanks to Windoze)
# the last one prefixed with r&#39;&#39; for raw format
#   is the cleanest / laziest because you can copy/paste from Explorer
shp = &quot;H:\\esm296-4f\\lab1\\raw\\ne_10m_admin_0_countries.shp&quot;
shp = &quot;H:/esm296-4f/lab1/raw/ne_10m_admin_0_countries.shp&quot;
shp = r&quot;H:\esm296-4f\lab1\raw\ne_10m_admin_0_countries.shp&quot;
shp = r&#39;H:\esm296-4f\lab1\raw\ne_10m_admin_0_countries.shp&#39;

# use arcpy to get the count of features in the shapefile
import arcpy
arcpy.GetCount_management(shp)</code></pre>
</div>
<div id="simplify-and-loop" class="section level2">
<h2><span class="header-section-number">3.11</span> Simplify and Loop</h2>
<p>The ModelBuilder export is a little verbose and extraneous with its variable naming. Let’s clean up the code to make a bit more sense of it in PythonWin so we can get into looping. Go to menu Edit &gt; Replace, copy/paste without quotes below, Replace All:</p>
<ul>
<li>Find:“_001“, Replace:”&quot;</li>
<li>Find:“wnd_sig995_2013”, Replace:“”</li>
</ul>
<p>You should then have these extraneous variables:</p>
<pre class="python"><code>u = &quot;u&quot;
s = &quot;in_memory\\s&quot;
v = &quot;v&quot;</code></pre>
<p>Since these are temporary in memory objects, you can delete their assignment lines above and replace the variable name with their string value in the functions below that. For example <code>u</code> to <code>&quot;u&quot;</code> from:</p>
<pre><code>arcpy.MakeNetCDFRasterLayer_md(u_nc, &quot;uwnd&quot;, &quot;lon&quot;, &quot;lat&quot;, u, &quot;&quot;, &quot;time 1&quot;, &quot;BY_INDEX&quot;)</code></pre>
<p>to:</p>
<pre><code>arcpy.MakeNetCDFRasterLayer_md(u_nc, &quot;uwnd&quot;, &quot;lon&quot;, &quot;lat&quot;, &quot;u&quot;, &quot;&quot;, &quot;time 1&quot;, &quot;BY_INDEX&quot;)</code></pre>
<p>Do this for all instances of the <code>u</code>,<code>v</code>,<code>s</code> variables (but not <code>u_nc</code>,<code>v_nc</code>, <code>s_tif</code> – the input/output variables). Be sure to replace the <code>s</code> variable with <code>&quot;in_memory\\s&quot;</code> though.</p>
<p>Also replace the <code>\&quot;%u%\&quot;</code> and <code>\&quot;%v%\&quot;</code> with simply <code>'u'</code> and <code>'v'</code> since these are no longer needed to perform inline variable substitution for some other raster path value as they did before in ModelBuilder.</p>
<p>Next, let’s insert a loop after defining u and v to loop through every 30th day of the year like we did with the Iterator in Model Builder previously.</p>
<pre class="python"><code># loop
for j in range(1, 365, 30):
    
    s_tif = &quot;H:\\esm296-4f\\lab1\\out\\s_%03d.tif&quot; % j
    print s_tif</code></pre>
<p>The s_tif has been modified with a <a href="https://docs.python.org/release/2.4.4/lib/typesseq-strings.html">string formatting operation</a> ot indicate a zero-padded triple digit <code>%02d</code> value is expected after the <code>%</code> outside the string.</p>
<p>Apply the same logic to <code>&quot;time 1&quot;</code> except we don’t need zero padding so just <code>%d</code> inside the string.</p>
<p>Before you try running the code, I recommend adding this line after <code>arcpy.CheckOutExtension(&quot;spatial&quot;)</code> to enable overwriting output:</p>
<pre><code>arcpy.env.overwriteOutput = True</code></pre>
<p>Now copy/paste all the code into the ArcMap Python Window. You will probably have to debug some minor syntatic errors (this is the majority effort in programming, truth be told [py-loop-answer]). Once you’re able to get this to work, be sure commit your changes.</p>
</div>
<div id="use-dates-in-loop" class="section level2">
<h2><span class="header-section-number">3.12</span> Use Dates in Loop</h2>
<p>Now that we’re in a proper programming environment, we can take advantage of other modules like <a href="https://docs.python.org/2/library/datetime.html">datetime</a>. (Python comes with many <a href="https://docs.python.org/2/py-modindex.html">available modules</a>, hence the term “batteries included”.) It would be best if we centered the julian day index on the 15th of the month for each month. To accomplish this, swap in these lines:</p>
<pre class="python"><code>yr = 2013
for mo in range(1, 13):

    j = (datetime.date(yr, mo, 15) - datetime.date(yr, 1, 1) + datetime.timedelta(1)).days    
    s_tif = &quot;H:\\esm296-4f\\lab1\\out\\s_%d-%02d.tif&quot; % (yr, mo)</code></pre>
<p>For those datetime functions to be available, you’ll need to import the module prior (preferably in vicinity of the other <code>import arcpy</code> statement).</p>
<pre class="python"><code>import datetime</code></pre>
</div>
<div id="extract-country-summary" class="section level2">
<h2><span class="header-section-number">3.13</span> Extract Country Summary</h2>
<p>Note that you can type a function in the ArcMap Python Window and on the right hand side it will provide the help documentation for that function.</p>
<p>I also find it handy to run any tool and then go into the <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//002100000013000000">Geoprocessing Results</a>) pane (menu Geoprocessing &gt; Results), right click on an executed tool and Copy As Python Snippet to get the function name and all its parameters.</p>
<div class="figure">
<img src="img/geoprocessing-results_copy-python-snippet.png" />
</div>
<p>Use this trick to add the final three lines to your script. Be sure to navigate to the filesystem path of all the inputs and not use layers only temporarily available in ArcMap memory. This will make the Python snippet reusable in the future and prevent comments like this in your snippets:</p>
<pre><code># Replace a layer/table view name with a path to a dataset (which can be a layer file) or create the layer/table view within the script
# The following inputs are layers or table views: &quot;s_2013_avg_country_stats&quot;</code></pre>
<div id="cell-statistics" class="section level3">
<h3><span class="header-section-number">3.13.1</span> Cell Statistics</h3>
<p><a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//009z0000007q000000">Cell Statistics</a> to get the MEAN wind speed on all the s_2013-##.tif rasters. I recommend outputting this raster to <code>H:\esm296-4f\lab1\out\s_2013_avg.tif</code> outside the file geodatabase.</p>
<p>If you did this the same as me then the first argument looks like this.</p>
<pre class="python"><code>&quot;H:/esm296-4f/lab1/out/s_2013-12.tif;H:/esm296-4f/lab1/out/s_2013-01.tif;H:/esm296-4f/lab1/out/s_2013-02.tif;H:/esm296-4f/lab1/out/s_2013-03.tif;H:/esm296-4f/lab1/out/s_2013-04.tif;H:/esm296-4f/lab1/out/s_2013-05.tif;H:/esm296-4f/lab1/out/s_2013-06.tif;H:/esm296-4f/lab1/out/s_2013-07.tif;H:/esm296-4f/lab1/out/s_2013-08.tif;H:/esm296-4f/lab1/out/s_2013-09.tif;H:/esm296-4f/lab1/out/s_2013-10.tif;H:/esm296-4f/lab1/out/s_2013-11.tif&quot;,&quot;H:/esm296-4f/lab1/out/s_2013_avg.tif&quot;</code></pre>
<p>which is quite beastly (scroll right). One cool feature of Python is its <a href="https://docs.python.org/2/tutorial/datastructures.html#list-comprehensions">list comprehensions</a> so above can be condensed.</p>
<p><code>';'.join(['H:/esm296-4f/lab1/out/s_2013-%02d.tif' % mo for mo in range(1, 13)])</code></p>
<p>The iterable list is used as input to the <a href="https://docs.python.org/2/library/stdtypes.html#str.join">string join</a>.</p>
</div>
<div id="zonal-statistics" class="section level3">
<h3><span class="header-section-number">3.13.2</span> Zonal Statistics</h3>
<p><a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//009z000000w8000000">Zonal Statistics As Table</a> to get the MIN_MAX_MEAN per country (recommend using NAME as Zone field).</p>
</div>
<div id="join-field" class="section level3">
<h3><span class="header-section-number">3.13.3</span> Join Field</h3>
<p><a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//001700000065000000">Join Field</a> to join the table back to the original country data.</p>
<p>Once you’ve added these Python snippets to your code, be sure to commit the final changes to your script and push to your courses repository.</p>
</div>
</div>
<div id="create-map-of-countries-wind-production" class="section level2">
<h2><span class="header-section-number">3.14</span> Create Map of Countries Wind Production</h2>
<p>Use the MAX value joined to the country to create a color ramped global map of wind production. Export as PNG to <code>H:\github\courses\esm296-4f\lab1\img\country_wind.png</code>.</p>
</div>
<div id="report-in-markdown" class="section level2">
<h2><span class="header-section-number">3.15</span> Report in Markdown</h2>
<p>Now just write a cursory report from RStudio menu File &gt; New File &gt; Text File. File &gt; Save As… <code>H:\github\courses\esm296-4f\lab1\README.md</code>. You can use simply use this template. Be sure to open the table and sort descending on MAX and MEAN to substitute answers for top 3.</p>
<pre><code># Lab 1

## Basic Model

![](img\uv_nc_to_s_tif.png)

## Model with Iterator

![](img\uv_nc_to_s_tif.png)

## Country Max Wind Production

![](img\country_wind.png)

The top 3 countries by MAX wind speed were:

1. [Country A]
1. [Country B]
1. [Country C]

The top 3 countries by MEAN wind speed were:

1. [Country D]
1. [Country E]
1. [Country F]
</code></pre>
<p>Github automatically renders this markdown, but you can also Preview HTML in RStudio. When you commit it, use the message <code>closes #2</code> to flag your lab done. Yay!</p>
<p>You’ll learn more about markdown and Rmarkdown next week, but here are some basics:</p>
<ul>
<li><a href="rmarkdown_cheatsheet.pdf">rmarkdown_cheatsheet.pdf</a></li>
<li><a href="https://help.github.com/articles/markdown-basics">https://help.github.com/articles/markdown-basics</a></li>
<li><a href="https://guides.github.com/features/mastering-markdown/">https://guides.github.com/features/mastering-markdown/</a></li>
<li><a href="https://stackedit.io">https://stackedit.io</a></li>
</ul>
</div>
<div id="extra-create-raster-catalog-for-time-slider-visualization" class="section level2">
<h2><span class="header-section-number">3.16</span> Extra: Create Raster Catalog for Time Slider Visualization</h2>
<p>For kicks and giggles, by loading the rasters into a raster catalog, you can use the <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//005z0000000z000000">Time Slider</a> and <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#/Creating_a_time_animation/000900000069000000/">create animations</a>.</p>
<div class="figure">
<img src="img/arcmap_time-slider.png" />
</div>
<p>Here’s the code to populate the raster catalog.</p>
<pre class="python"><code># create raster catalog for use with Time Slider and generating an animation
import os
rasters = &#39;;&#39;.join([&#39;H:/esm296-4f/lab1/out/s_2013-%02d.tif&#39; % mo for mo in range(1, 13)])
catalog = &#39;H:/esm296-4f/lab1/lab1.gdb/wind_catalog&#39;
arcpy.CreateRasterCatalog_management(os.path.dirname(catalog), os.path.basename(catalog), raster_management_type=&#39;UNMANAGED&#39;)
arcpy.RasterToGeodatabase_conversion(rasters, catalog)
arcpy.CalculateDefaultGridIndex_management(catalog)
arcpy.AddField_management(catalog, &#39;date_beg&#39;, &#39;DATE&#39;)
arcpy.AddField_management(catalog, &#39;date_end&#39;, &#39;DATE&#39;)
code_block = &quot;&quot;&quot;
def get_date(s, p):
    y = int(s[2:6])
    m = int(s[7:9])
    if p == &#39;beg&#39;:
        return datetime.datetime(y, m, 1)
    elif p == &#39;end&#39;:
        if m == 12:
            return datetime.datetime(y+1, 1, 1) - datetime.timedelta(1)
        else:
            return datetime.datetime(y, m+1, 1) - datetime.timedelta(1)       
&quot;&quot;&quot;
arcpy.CalculateField_management(catalog, &#39;date_beg&#39;, &quot;get_date(!Name!, &#39;beg&#39;)&quot;, &#39;PYTHON_9.3&#39;, code_block)
arcpy.CalculateField_management(catalog, &#39;date_end&#39;, &quot;get_date(!Name!, &#39;end&#39;)&quot;, &#39;PYTHON_9.3&#39;, code_block)```</code></pre>
<p>You’ll need to <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//005z0000000p000000">enable time</a> on this layer before being able to use the Time Slider.</p>
<div class="figure">
<img src="img/arcmap_time-aware-layer.png" />
</div>
</div>
<div id="more-on-python" class="section level2">
<h2><span class="header-section-number">3.17</span> More on Python</h2>
<ul>
<li><a href="http://www.software-carpentry.org/v5/novice/python/index.html">Software Carpentry: Python</a></li>
<li><a href="https://github.com/ipython/ipython/wiki/A-gallery-of-interesting-IPython-Notebooks">iPython: Gallery of Interesting IPython Notebooks</a></li>
</ul>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>For details on conversion betwen coordinate systems, see <a href="http://en.wikipedia.org/wiki/Polar_coordinate_system#Converting_between_polar_and_Cartesian_coordinates">Wikipedia: Polar coordinate system - Converting between polar and Cartesian coordinates</a>. Note that the <a href="http://en.wikipedia.org/wiki/Geographic_coordinate_system">geographic coordinate system</a> and <a href="http://en.wikipedia.org/wiki/Map_projection">projected coordinate systems</a> are for measuring locations and not angle &amp; magnitude like the polar / Cartesian coordinate systems here.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Details for <a href="http://www.unidata.ucar.edu/software/netcdf/">NetCDF from UCAR</a> and <a href="http://www.hdfgroup.org/">HDF from NCSA</a>.<a href="#fnref2">↩</a></p></li>
</ol>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
